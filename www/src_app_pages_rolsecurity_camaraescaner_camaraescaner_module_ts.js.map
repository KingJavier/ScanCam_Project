{"version":3,"file":"src_app_pages_rolsecurity_camaraescaner_camaraescaner_module_ts.js","mappings":"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","sources":["./src/app/pages/rolsecurity/camaraescaner/camaraescaner-routing.module.ts","./src/app/pages/rolsecurity/camaraescaner/camaraescaner.module.ts","./src/app/pages/rolsecurity/camaraescaner/camaraescaner.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { CamaraescanerPage } from './camaraescaner.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: CamaraescanerPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class CamaraescanerPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { CamaraescanerPageRoutingModule } from './camaraescaner-routing.module';\r\n\r\nimport { CamaraescanerPage } from './camaraescaner.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    CamaraescanerPageRoutingModule\r\n  ],\r\n  declarations: [CamaraescanerPage]\r\n})\r\nexport class CamaraescanerPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\n//importación de las rutas\r\nimport { Router } from '@angular/router';\r\n//importación de los servicios de la api\r\nimport { TaskService } from 'src/app/services/task.service';\r\n//importacion de toaskcontroller\r\nimport { ToastController } from '@ionic/angular';\r\n\r\nimport { Camera, CameraResultType, CameraSource, Photo } from '@capacitor/camera';\r\nimport { Filesystem, Directory } from '@capacitor/filesystem';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\nimport { UserPhoto } from './../../../interfaces/task';\r\nimport { Socket } from 'ngx-socket-io';\r\n\r\n@Component({\r\n  selector: 'app-camaraescaner',\r\n  templateUrl: './camaraescaner.page.html',\r\n  styleUrls: ['./camaraescaner.page.scss'],\r\n})\r\nexport class CamaraescanerPage implements OnInit {\r\n  //llamdo de los datos url y name como dato tipo string\r\n  url: string;\r\n\r\n  nombre: string;\r\n\r\n  name: any;\r\n  apellido: any;\r\n  role: string;\r\n  email: string;\r\n  telefono: any;\r\n  documento: any;\r\n  coincidencia: any;\r\n  tipo: any;\r\n\r\n  //? Matriz que contendra uan referencia a cada foto.\r\n  public photos: UserPhoto[] = [];\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private foto: TaskService,\r\n    //inyecta la importación de tosatcontroller\r\n    public toastController: ToastController,\r\n    //se llama a socket.io\r\n    private socket: Socket,\r\n  ) {\r\n    //llamdo del nombre del localstorage\r\n    this.nombre=localStorage.getItem('name');\r\n  }\r\n\r\n  async errorl(mensaje, duracion) {\r\n    //función que hace el llamado de una alerta sobre un error\r\n    const toast = await this.toastController.create({\r\n      message: mensaje,\r\n      color: 'danger',\r\n      duration: duracion,\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  async chec(mensaje, duracion) {\r\n    //función que hace el llamado de una alerta sobre un error\r\n    const toast = await this.toastController.create({\r\n      message: mensaje,\r\n      color: 'success',\r\n      duration: duracion,\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  ngOnInit() {\r\n    //llamdo de la foto\r\n    // this.traerfotol();\r\n  }\r\n\r\n  salir(){\r\n    //función de cerrar seción\r\n    localStorage.clear();\r\n    this.router.navigate(['login']);\r\n  }\r\n\r\n  traerfotol(){\r\n    //función de tarer la foto de los servicios de la api\r\n    const token = localStorage.getItem('token');\r\n    const idImgPerfil = localStorage.getItem('idImgPerfil');\r\n\r\n    //console.log('Token -->',token);\r\n    //console.log('imgPer -->',idImgPerfil);\r\n\r\n    this.foto.traerfotoperfil(token, idImgPerfil).subscribe((res: any)=>{\r\n     // console.log(res.data.url);\r\n      this.url = res.data.url;\r\n    });\r\n\r\n  }\r\n\r\n  addPhotoToGallery() {\r\n    this.addNewToGallery();\r\n  }\r\n\r\n  //? método para tomar una fotografia. devuelve un blob\r\n  public async addNewToGallery() {\r\n    //? Tomar una foto\r\n    const capturedPhoto = await Camera.getPhoto({\r\n      resultType: CameraResultType.Uri,\r\n      source: CameraSource.Camera,\r\n      //?resolucion de la foto\r\n      quality: 100\r\n    });\r\n\r\n    //? Guarda la imagen y la agrega a la colección de fotos.\r\n    const savedImageFile = await this.savePicture(capturedPhoto);\r\n\r\n    //console.log(savedImageFile);\r\n\r\n    //? unshift Inserta nuevos elementos al comienzo de una matriz y devuelve la nueva longitud de la matriz.\r\n    this.photos.unshift(savedImageFile);\r\n\r\n  }\r\n\r\n  public async savePicture(photo: Photo) {\r\n    //? Convierta la foto al formato base64, requerido por la API del sistema de archivos para guardar\r\n    const base64Data = await this.readAsBase64(photo);\r\n\r\n    //? Escribir el archivo en el directorio de datos.\r\n    const fileName = new Date().getTime() + '.jpeg';\r\n    const savedFile = await Filesystem.writeFile({\r\n      path: fileName,\r\n      data: base64Data,\r\n      directory: Directory.Data,\r\n    });\r\n\r\n    //console.log('Chingada',savedFile);\r\n\r\n    const base64 = {\r\n      base: base64Data,\r\n    };\r\n\r\n    const token = localStorage.getItem('token');\r\n\r\n    this.foto.enviarfototemp(token, base64).subscribe((res: any) => {\r\n      // console.log(res);\r\n\r\n      this.name = res.dataUser.name;\r\n      this.apellido = res.dataUser.apellido;\r\n      this.documento = res.dataUser.documento;\r\n      this.telefono = res.dataUser.telefono;\r\n      this.email = res.dataUser.email;\r\n      this.role = res.dataUser.role[0];\r\n      this.coincidencia = 100 * res.datosazure[0].candidates[0].confidence.toFixed(1);\r\n      this.tipo = res.tipo.tipo;\r\n\r\n      this.socket.emit('cliente:fototemp', {\r\n        res\r\n      });\r\n\r\n      this.socket.emit('cliente:estadisticas', {\r\n        res\r\n      });\r\n\r\n      //this.datosUser = res.datosUser;\r\n      //this.datosazure = res.datosazure;\r\n      const correcto = res.dataUser;\r\n\r\n      if(correcto === res.dataUser){\r\n      this.chec( res.dataUser.name, 4000);\r\n      }\r\n    },error => {\r\n    console.log(error);\r\n\r\n    const err = error.error.tipoError;\r\n\r\n    if(err === 'ERROR DETECTANDO ROSTRO'){\r\n      this.errorl('DEBE APARECER UN ROSTRO PARA REGISTRAR LA ENTRADA', 5000);\r\n    }else if(err === 'ERROR ROSTRO NO ENCONTRADO'){\r\n      this.errorl('ROSTRO NO ENCONTRADO EN LA BASE DE DATOS', 5000);\r\n    }\r\n\r\n    });\r\n\r\n    //? Use webPath para mostrar la nueva imagen en lugar de base64, ya que ya está cargada en la memoria.\r\n    return {\r\n      filepath: fileName,\r\n      webviewPath: photo.webPath\r\n    };\r\n  }\r\n\r\n  public async readAsBase64(photo: Photo) {\r\n    //? Obtiene la foto, léala como un blob y luego conviértala al formato base64\r\n    const response = await fetch(photo.webPath);\r\n    const blob = await response.blob();\r\n\r\n    //console.log('vaina loca',response);\r\n    //console.log('vaina loca X2', blob);\r\n\r\n    return await this.convertBlobToBase64(blob) as string;\r\n  }\r\n\r\n  //? Convierte la imagen a base64\r\n  public convertBlobToBase64 = (blob: Blob) => new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onerror = reject;\r\n    reader.onload = () => {\r\n        resolve(reader.result);\r\n    };\r\n\r\n    reader.readAsDataURL(blob);\r\n\r\n    //console.log(reader);\r\n  });\r\n\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///"}